<% include ../partials/header.ejs %>


    <div class="landing">
    <!-- couldn't figure out php, so this will have to to for now -->
    <!-- <form onsubmit="window.location = 'http://localhost:4567/encounters/' + search.value; return false;">
<label>RISK FACTOR BY ZIP CODE</label><br>
<input class="search" placeholder="5 Digit Zip Code" type="search" name="search"></input>
<input type="submit" value="Search">
</form>
</div> -->

<div id="mapid">MAP HERE</div>

<script>

getEncounters = () => { return fetch('/encounters.json').then(response => response.json()); };



    const mymap = L.map('mapid').setView([37.576990, -98.617800], 4.4);
    let geojson = {};

    L.tileLayer(
        'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            id: 'mapbox.streets'
        }).addTo(mymap);

    getEncounters().then(data => {
        data.forEach(element => {
            geojson = {
                lat: element.latitude,
                lon: element.longitude
            }
            //  console.log(geojson)
            
            // add marker to map 
            L.marker([geojson.lat, geojson.lon]).addTo(mymap);

            // geojson.forEach(function(marker) { 
            //     console.log(marker) 
            // });

            // return geojson;
        })
    })



    //  L.marker([37.576990, -98.617800]).addTo(mymap)
    //  .bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();

    // L.circle([37.576990, -98.617800], 0, {
    //     color: 'red',
    //     fillColor: '#f03',
    //     fillOpacity: 0.5
    // }).addTo(mymap).bindPopup("I am a circle.");

    // var popup = L.popup();

// function onMapClick(e) {getEncounters().then(encounters => { encounters.forEach(element => { let marker = L.marker([element.latitude, element.longitude]).addTo(mymap);
// marker.bindPopup(`<b>Name: ${element.subject_name}</b>`);})})};


    // mymap.on('click', onMapClick);


// document.querySelector(".deathButton").addEventListener('click', () => { getEncounters().then(encounters => { encounters.forEach(element
// => { let marker = L.marker([element.latitude, element.longitude]).addTo(mymap); marker.bindPopup(`
// <b>Name: ${element.subject_name}</b>`).openPopup(); }); }); });

// var layer = L.geoJson("/encounters/encounters.geojson", { color: 'red', fillColor: '#f03', fillOpacity:'0.5' }).addTo(map);

</script>
</div>


    <% include ../partials/footer.ejs %>
